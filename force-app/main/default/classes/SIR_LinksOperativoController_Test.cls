/**********************************************************************************************************************
    Name: SIR_LinksOperativoController_Test
    Copyright Â© 2022 CaixaBank

    Historial
    ---------
    VERSION		USER_STORY		AUTHOR				DATE			Description
    1.0			Test Class		Atmira       	    01/09/2022		Init version

***********************************************************************************************************************/
@isTest
public with sharing class SIR_LinksOperativoController_Test {

    @isTest
    public static void testGetLinks() {
        UserRole rol = new UserRole(DeveloperName = 'testRole', Name = 'testRole');
        insert rol;
        User usuario = SIR_TestDataFactory.createTestUser('usuarioTest', rol, 'System Administrator', 'U0111111', '001-09999');
        System.runAs(usuario){
            Map<String,Schema.RecordTypeInfo> mapRTsObjectsAccount = Schema.SObjectType.Account.getRecordTypeInfosByDeveloperName();
            Id accClienteRecordTypeId = mapRTsObjectsAccount.get(SIR_Constantes.CLIENTE_RECORDTYPE_DEVELOPERNAME).getRecordTypeId(); 
            Account customer = new Account(
                FirstName = 'Account',
                LastName = 'Test',
                CC_TipoPersona__c = 'J',            	
                RecordTypeId = accClienteRecordTypeId,
                AV_NumPerso__c = '11582114',
                CC_Numero_Documento__c = '11111111P'
            );
            insert customer;
            List<SIR_LinksOperativosMCS__mdt> listActive = [SELECT Id, SIR_Url2__c, SIR_Orden__c, SIR_Externo__c, Label 
                                                              FROM SIR_LinksOperativosMCS__mdt
                                                              WHERE SIR_Activo__c =: true
                                                              AND SIR_Seccion__c LIKE: 'Account'];
            String urlOrg = 'https://test.salesforce.com';
            Test.startTest();
            
            List<SIR_LCMP_LinksOperativoController.LinksOperativos> listLinks = SIR_LCMP_LinksOperativoController.getLinks('Account', customer.Id, urlOrg); 
            Test.stopTest();
            system.assertEquals(listLinks.size(), listActive.size());
        } 
    }
}