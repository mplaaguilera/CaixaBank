<!--
    INI - INS: 19/04/2021 -> Luis Mesa Garcia -> US200298:
  Asociar Reclamaciones:

  DESC: 	Lightning web component para poder visualizar y asociar Reclamaciones de un mismo propietario siempre y cuando
    sus pretensiones sean las mismas o tengan relación entre Reclamaciones ya existentes.
  
  OBJ:	Las reclamaciones nuevas en el sistema quedarán como Inadmitidas, y la antigua tendrá relación con las nuevas.
-->

<!--
  MOD - 14/06/2021 -> Luis Mesa Garcia -> US233794:

  DESC:   Incluir reclamantes de cada Reclamación
-->


<template>
  <lightning-card title="Reclamaciones relacionadas" icon-name="">

    <div class="slds-grid slds-wrap">
      <template if:true={listadoReclamaciones}>
        <br />        
        <template for:each={listadoReclamaciones} for:item="reclamacion">
          <div key={reclamacion.reclamacionActual.Id} style="padding:8px"
            class="slds-large-size_6-of-12 slds-medium-size_12-of-12 slds-grid slds-wrap slds-p-right_small">

            <!--RECLAMACIONES-->
            <lightning-card key={reclamacion.reclamacionActual.Id} title={reclamacion.reclamacionActual.CaseNumber}
              icon-name="standard:case" class="slds-card_boundary" variant="narrow" style="width: 100%">

              <div class="slds-m-left_small slds-text-heading_small">

                <p>Asunto:
                  <lightning-button style="padding-left:8px" variant="base" id={reclamacion.reclamacionActual.Id}
                    key={reclamacion.reclamacionActual.Id} label={reclamacion.reclamacionActual.Subject}
                    onclick={navigateToCase} ></lightning-button>
                </p>

              </div>

              <div class="slds-m-left_small  slds-grid slds-wrap slds-text-heading_small">

                <div class="slds-size_6-of-12">
                  <p>
                    Fecha alta:
                    <lightning-formatted-date-time style="padding-left:8px"
                      value={reclamacion.reclamacionActual.CreatedDate}></lightning-formatted-date-time>
                  </p>
                </div>
                <div class="slds-size_6-of-12">
                  Estado:
                  {reclamacion.reclamacionActual.Status}
                </div>
              </div>

              <br />  
              <template if:true={esPropietario}>  

                <lightning-button key={reclamacion.reclamacionActual.Id} id={reclamacion.reclamacionActual.Id} style= "padding: 4px"
                  label="Desvincular" slot="actions" variant="brand" onclick={handleClickDesvincular} disabled={reclamacion.desactivarBotonDesvincular}>
                </lightning-button>

                <lightning-button key={reclamacion.reclamacionActual.Id} id={reclamacion.reclamacionActual.Id} style= "padding: 4px"
                  label="Vincular" slot="actions" variant="brand" onclick={handleClick} disabled={reclamacion.desactivarBotonVincular}>
                </lightning-button>

              </template> 
              <template if:false={esPropietario}>  
                          
                <lightning-button key={reclamacion.reclamacionActual.Id} id={reclamacion.reclamacionActual.Id}
                  label="Vincular" slot="actions" variant="brand" onclick={handleClick} disabled="true">
                </lightning-button>

              </template> 
              
              <div class="slds-card__header slds-grid slds-wrap" style="padding: 12 px">


                <!--RECLAMANTES -->

                <div class="slds-size_12-of-12">
                  <template if:true={reclamacion.listaDeReclamantesPrincipales}>
                    <span style="padding: 5px">Reclamante Principal:</span>
                    <template for:each={reclamacion.listaDeReclamantesPrincipales} for:item="reclamanteP">
                      <div style="padding: 4px" key={reclamanteP} class="slds-size_12-of-12">
                          <lightning-badge label={reclamanteP.SAC_Account__r.Name}></lightning-badge>
                      </div>
                    </template>
                    <br />  
                  </template>
                  
                </div>
                <div class="slds-size_12-of-12">
                  <template if:true={reclamacion.listaDeReclamantesSecundarios}>
                    <span style="padding: 5px">Reclamantes Secundarios:</span>
                    <template for:each={reclamacion.listaDeReclamantesSecundarios} for:item="reclamanteS">
                      <div style="padding: 4px" key={reclamanteS.Id} class="slds-size_12-of-12">
                          <lightning-badge key={reclamanteS.Id} label={reclamanteS.SAC_Account__r.Name}></lightning-badge>
                      </div>
                    </template>
                  </template>
                  <br />
                </div>



                <!--PRETENSIONES-->
                <template for:each={reclamacion.pretensiones} for:item="pretension">
                  <div key={pretension.Id} class="slds-size_6-of-12">

                    <lightning-card key={pretension.Id} title={pretension.CaseNumber}
                      icon-name="standard:guidance_center">

                      <div key={pretension.Id}>

                        <ul key={pretension.Id}>
                          <li class="slds-p-horizontal_small slds-size_1-of-1 slds-medium-size_1-of-1">
                            <article class="slds-tile slds-media slds-card__tile slds-hint-parent">

                              <div class="slds-media__body">
                                <div class="slds-grid">
                                  <h3 class="slds-tile__title">
                                    <lightning-button variant="base" id={pretension.Id} key={pretension.Id}
                                      label={pretension.Subject} onclick={navigateToCase}></lightning-button>
                                  </h3>
                                  <div class="slds-shrink-none">

                                  </div>
                                </div>
                                <div class="slds-tile__detail">
                                  <dl class="slds-list_horizontal slds-wrap">
                                    <dt class="slds-item_label slds-text-color_weak" title="Estado">Estado:
                                    </dt>

                                    <dd class="slds-item_detail" title="Valor Descripcion">
                                      <template if:true={pretension.Status}>
                                        &nbsp; {pretension.Status}
                                      </template>
                                    </dd>
                                    <dt class="slds-item_label slds-text-color_weak" title="Grupo de trabajo">
                                      Grupo trabajo:</dt>
                                    <dd class="slds-item_detail" title="Valor Grupo">
                                      <template if:true={pretension.SEG_Grupo__c}>
                                        &nbsp;  {pretension.SEG_Grupo__r.Name}
                                      </template> 
                                    </dd>
                                    <dt class="slds-item_label slds-text-color_weak" title="Propietario">
                                      Propietario:  
                                    </dt>
                                    <dd class="slds-item_detail" title="Valor Propietario">
                                      <template if:true={pretension.Owner.Name}>
                                        &nbsp; {pretension.Owner.Name}
                                      </template>
                                    </dd>
                                  </dl>
                                </div>
                              </div>
                            </article>
                          </li>
                        </ul>
                        <br key={pretension.Id} />
                      </div>
                    </lightning-card>
                  </div>
                </template>

                <br />


              </div>
            </lightning-card>
            <hr key={reclamacion.reclamacionActual.Id} />
          </div>
        </template>

      </template>
    </div>
  </lightning-card>

  <div>
    <template if:true={isLoading}>
      <div class="slds-p-around_x-large">
        <lightning-spinner alternative-text="Loading" size="large" variant="brand"></lightning-spinner>
      </div>
    </template>
  </div>
  
</template>