<template>
	<div class="filter-card">
		<lightning-card variant="Narrow">
			<lightning-button-icon if:true={showDetail} icon-name="utility:chevrondown" size="small" class="chev-icon slds-float_right slds-m-right_large" variant="container" onclick={toggleShow}></lightning-button-icon>
			<lightning-button-icon if:false={showDetail} icon-name="utility:chevronright" size="small" class="chev-icon slds-float_right slds-m-right_large" variant="container" onclick={toggleShow}></lightning-button-icon>
			<div class="slds-m-around_x-small">
                <div class="slds-m-top_none slds-m-around_x-small slds-float_right"> 
                    <lightning-button  class=" slds-m-top_none" label={labels.newOppor} onclick={handleClickOppo} ></lightning-button>
                    <template if:true={isShowFlowAction}>
                        <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="modal-heading-03" class="slds-modal slds-fade-in-open slds-modal_small">
                            <div class="slds-modal__container">
                                <lightning-button-icon class="slds-button slds-button_icon slds-modal__close" variant="container" icon-name="utility:close" icon-class="slds-icon-text-light" size="medium" onclick={hideFlowAction}></lightning-button-icon>
                                <div class="slds-modal__header">
                                    <h1 id="modal-heading-03" class="slds-modal__title slds-hyphenate">{flowlabel}</h1>
                                </div>
                                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-3">
                                    <div class="slds-is-relative">
                                        <lightning-flow flow-api-name={flowName} flow-input-variables={inputFlowVariables} onstatuschange={handleStatusChange}> </lightning-flow>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
                    </template>
                </div>
                <h1 slot="title">
                    <lightning-icon class="slds-m-left_medium" icon-name="standard:search" alternative-text="Filtros de búsqueda" title="Search"></lightning-icon>
                    <b><span class="slds-truncate slds-card__header">{labels.filtroB}</span></b>
					<!-- <lightning-icon class="slds-m-left_large" icon-name="standard:search" alternative-text="Filtros de búsqueda" title="Search"></lightning-icon>
					<span class="slds-text-heading_small slds-truncate title">Filtros de búsqueda</span> -->
                </h1>
            </div>

			<div if:true={showDetail}>
				<!-- Parte de arriba -->
				<div>
					<!-- Primera fila   -->
					<div data-id="lookup2" class="slds-grid slds-gutters slds-m-around_small">
						<div class="slds-col slds-size_1-of-5 ">
						<!-- Office -->
							<c-av_-lookup data-id="clookup5" selection={initialSelectionOffice}
								errors={errors} onsearch={handleSearchOffice} onselectionchange={handleSelectionChange}
								fieldlabel={labels.centro} placeholder={officePlaceholder} is-multi-entry={isMultiEntry2}
								required>
							</c-av_-lookup>
						</div>
						<!-- Origen-->
						<div class="slds-col slds-size_1-of-5 ">
							<lightning-combobox  name="recordTypes" label={labels.origen} 
								options={optionsOppoOrigen} placeholder={labels.seleccionar} onchange={handleChangeOrigen} value={origenFilter} required>
							</lightning-combobox>
						</div>
						<!-- Stage -->
						<div class="slds-col slds-size_1-of-5 ">
							<lightning-combobox  name="status" label={labels.etapa} options={optionsOppoStatus} placeholder={labels.seleccionar}
								onchange={handleChangeEstado} value={statusFilter} required>
							</lightning-combobox>
						</div>
						<!-- Product  ya no es required-->
						<div class="slds-col slds-size_1-of-5 ">
							<c-av_-lookup  data-id="clookup3" selection={initialSelection} errors={errors}
								onsearch={handleSearchProduct} onselectionchange={handleSelectionChange} fieldlabel={labels.producto} placeholder={labels.buscarProductos}
								is-multi-entry={isMultiEntry2}>
							</c-av_-lookup>
						</div>

						<!-- Employee  ya no es required-->
						<div class="slds-col slds-size_1-of-5">
							<lightning-combobox  name="owner" label={labels.empleadoAsignado} 
								options={optionsEmployee} value={employeeFilter} placeholder={labels.seleccionar} onchange={handleChangeEmployee} >
							</lightning-combobox>
						</div>
					</div>
					<!-- Fin primera fila -->

					<!-- Segunda fila -->
					<div class="slds-grid slds-gutters slds-form_vertical slds-m-around_x-small">
						<div if:true={isOriginAll} class="slds-col slds-size_4-of-5">
							<h3 class = "slds-text-color_error">{labels.errorProdRellenoConFiltroTodos}</h3>
						</div>
						<div if:false={isOriginAll} class="slds-col slds-size_4-of-5"></div>
						<!--<div class="slds-col slds-size_1-of-4"></div>
						<div class="slds-col slds-size_1-of-4"></div> -->
						
						<div class="slds-col slds-size_1-of-5 slds-list_horizontal">
							<lightning-input type="toggle" onchange={handleAnotherOffice} checked={isAnotherOffice} name="anotherOffice" variant="label-hidden" message-toggle-active="" message-toggle-inactive=""></lightning-input>
							<label class="slds-form-element__label slds-m-left_x-small"> Ver empleados otra oficina</label>
						</div>
					</div>
					<!-- Fin segunda fila -->
					
					
					<!-- Tercera fila -->
					<div if:true={showEmployees} >
						<div class="slds-grid slds-gutters slds-form_vertical slds-m-around_x-small">
							<div class="slds-col slds-size_1-of-4">
								<!-- Employee's multiselection -->
									<h5><strong>{labels.empleadosSeleccionados}</strong></h5>
									<div class="slds-list_horizontal">
										<template for:each={selectedEmployees} for:item="employee" >
											<div class="slds-m-around_xxx-small" key={employee.bucleId}  data-id={employee.id}>						
												<lightning-pill label={employee.label} name ={employee.id} onremove={unSelectEmployee}>
														<lightning-icon icon-name="standard:user" alternative-text="user"></lightning-icon>
												</lightning-pill>
											</div>
										</template>
									</div>
							</div>
						</div>
					</div>
					<template if:true={showSelectedProducts}>
						<div class="slds-grid slds-gutters slds-form_vertical slds-m-around_x-small">
							<div class="slds-col slds-size_1-of-4 slds-wrap">
							<!-- Product's multiselection -->
								<h5><strong>{labels.productosSeleccionados}</strong></h5>
								<div class="slds-list_horizontal">
									<template for:each={selectedProducts} for:item="product" >
										<div class="slds-m-around_xxx-small" key={product.bucleId}> 
											<lightning-pill label={product.label} name={product.value} onremove={unSelectProduct}>
													<lightning-icon icon-name="standard:product" alternative-text="product"></lightning-icon>
											</lightning-pill>
										</div>
									</template>
								</div>
							</div>
						</div>
					</template>
					<!-- Fin tercera fila -->

					<!-- Cuarta fila -->
					<template if:true={showSelectedParticipe}>
						<div class="slds-grid slds-gutters slds-form_vertical slds-m-around_x-small">
							<div class="slds-col slds-size_1-of-4">
								<!-- Participe's multiselection -->
								<h5><strong>{labels.participesSeleccionados}</strong></h5>
						
								<!-- <div class="" > -->
								<div class="slds-list_horizontal">
									<template for:each={selectedParticipe} for:item="participe" >
										<div class="slds-m-around_xxx-small" key={participe.label} > 
											<lightning-pill  label={participe.label} name={participe.value} onremove={unSelectParticipe}>
													<lightning-icon icon-name="standard:user" alternative-text="participe"></lightning-icon>
											</lightning-pill>
										</div>
									</template>
								</div>
							</div>		
						</div>
					</template>
					<!-- Fin cuarta fila -->
				</div>
				<!-- Fin parte de arriba -->

				<!-- Parte de Medio -->
				<div if:true={showMoreFiltersDiv}>
					<div class="slds-m-vertical_large">
						<div data-id="lookup2" class="slds-grid slds-gutters slds-m-around_x-small slds-border_top ">
							<!-- Opportunity name form2alinear-->
							<div class="slds-col slds-size_1-of-4 ">
								<lightning-input type="text" label={labels.nombreOpp} value={subjectFilter} onchange={handleChangeSubject}></lightning-input>
							</div>
							<!-- Importe(desde) -->
							<div class="slds-col slds-size_1-of-4 ">
								<lightning-input  type="text"  name="Importe" min={cero} label={labels.importeDesde} onchange={handleChangeImporte} ></lightning-input>
							</div>
							<!-- Fecha de cierre (desde) -->
							<div class="slds-col slds-size_1-of-4 ">
								<lightning-input type="date"  name="fechaCierreD" max={todaysDate} label={labels.fechaCierreDesde} onchange={handleChangeFechaCierreD} ></lightning-input>
							</div>
							<!-- Fecha de cierre (hasta) -->
							<div class="slds-col slds-size_1-of-4 ">
								<lightning-input type="date" name="fechaCierreH"  label={labels.fechaCierreHasta} onchange={handleChangeFechaCierreH} ></lightning-input>
							</div>
						</div>
					

						<div data-id="lookup3" class="slds-grid slds-gutters slds-m-around_x-small">
							<!-- Probabilidad de exito picklist -->
							<div class="slds-col slds-size_1-of-4 ">
								<lightning-combobox  name="Probabilidad" label={labels.probabilidadExito}
									options={optionsProbabilidad} placeholder={labels.seleccionar} onchange={handleChangeProbabilidad} value={targetProbabilidad}>
								</lightning-combobox>	
							</div>
							
							<!-- Participe. Permite la multiselección opportunity team -->
							<div class="slds-col slds-size_1-of-4 ">
								<c-av_-lookup  data-id="clookupPar" selection={initialSelection} errors={errors} 
								onsearch={handleSearchParticipe} onselectionchange={handleSelectionChange} fieldlabel={labels.participe} placeholder={labels.buscarParticipe}
								is-multi-entry={isMultiEntry3}>
								</c-av_-lookup>
							</div>
							<!-- Cliente -->
							<div class="slds-col slds-size_1-of-4 ">
								<c-av_-lookup data-id="clookup4" selection={initialSelection} 
									errors={errors} onsearch={handleSearchAccount} onselectionchange={handleSelectionChange}
									fieldlabel={labels.cliente} placeholder={clientPlaceholder} is-multi-entry={isMultiEntry2}>
								</c-av_-lookup>
							</div>
						</div>
					</div>
				</div>
				<!-- Fin parte de medio -->

				<!-- Parte de abajo -->
				<div class="slds-m-around_x-small slds-float_right">
					<lightning-button class="slds-m-horizontal_medium" label={seeFiltersLabel} onclick={showMoreFilters}></lightning-button>
					<lightning-button class="slds-m-horizontal_medium" label={labels.reset} onclick={resetFilters}></lightning-button>
					<lightning-button class="slds-m-horizontal_medium" variant="brand" label={labels.buscar} onclick={handleSearchData} disabled={buttonDisabled}></lightning-button>
				</div>
				<!-- Fin parte de abajo -->

			</div>
		</lightning-card>
	</div>
	<div class="recuperarbotones">
		<lightning-card if:true={firstSearch} variant="Narrow"  title={labels.resultados} icon-name={iconName}>
			<div class="total-data-text" >
				<lightning-formatted-text class="slds-text-title--caps totalText" value={totalRecountCount}></lightning-formatted-text>
				<!--<div class="help-text">
					<lightning-helptext if:true={helpMessage} content={recordLimit}></lightning-helptext>
				</div>-->
				<div class="help-text">
					<p if:true={helpMessage}><lightning-formatted-text value={recordLimit}></lightning-formatted-text></p>
				</div>
			</div>
			<div if:true={data} class=" table-container-paginacion">
				<!--<c-av_-paginator records={opps} 
					total-records={opps.length} 
					onpaginatorchange={handlePaginatorChange}>
				</c-av_-paginator>-->
				<lightning-datatable data-id="divblock" key-field="Id" 
					data={items} 
					columns={columns}
					row-number-offset={rowNumberOffset}
					onrowselection={getSelectedName}
					default-sort-direction={defaultSort}
                    sorted-direction={sortDirection}
                    sorted-by={sortByFieldName}
                    onsort={handleSortData}
					load-more-offset>
				</lightning-datatable>
				<br/>
				<div if:true={isMultipagina}>
					<lightning-layout horizontal-align="space">
						<lightning-layout-item flexibility="auto">
							<lightning-button label={labels.anterior} icon-name="utility:chevronleft" onclick={previousHandler}>
							</lightning-button>
						</lightning-layout-item>
						<lightning-layout-item flexibility="auto">
							{labels.pagina} {page} {labels.de} {totalPage}
						</lightning-layout-item>
						<lightning-layout-item flexibility="auto">
							<lightning-button label={labels.posterior} icon-name="utility:chevronright" icon-position="right"
								onclick={nextHandler}></lightning-button>
						</lightning-layout-item>
					</lightning-layout>
				</div>
			</div>
			<lightning-spinner if:true={showSpinner} alternative-text="Cargando..." variant="brand" size="medium" class="spin-cls" ></lightning-spinner>
			
		</lightning-card>
	</div>

	<div if:true={showAssignment} class="divPadding">
		<lightning-card if:true={firstSearch} variant="Narrow" title="Asignación" icon-name="standard:avatar">
			<lightning-tabset>
				<lightning-tab label={labels.oficina}>
					<div data-id="lookup1" class="slds-form-element__label assign-lookup slds-size_1-of-4">
						<c-av_-lookup class="lookup-cmp" style="width: 20rem;" data-id="clookup1" selection={initialSelection} 
							errors={errors} onsearch={handleSearch} onselectionchange={handleSelectionChange} 
							fieldlabel={employeeLabel} placeholder={employeePlaceholder} is-multi-entry={isMultiEntry} my-office="true">
						</c-av_-lookup>
					</div>
					<lightning-button label={labels.asignar} onclick={handleModal} class="my-office-true"></lightning-button>
					<lightning-spinner if:true={showSpinner} alternative-text="Cargando..." variant="brand" size="medium" class="spin-cls" ></lightning-spinner>
				</lightning-tab>
				<lightning-tab label={labels.otraOficina}>
					<div data-id="lookup6" class="slds-form-element__label assign-lookup slds-size_1-of-4">
						<c-av_-lookup class="lookup-cmp" style="width: 20rem;"
							data-id="clookup6"
							selection={initialSelection}
							errors={errors}
							onsearch={handleSearch}
							onselectionchange={handleSelectionChange}
							fieldlabel={employeeLabel}
							placeholder={employeePlaceholder}
							is-multi-entry={isMultiEntry}
							my-office="false"
						>
						</c-av_-lookup>
					</div>
					<lightning-button label={labels.asignar} onclick={handleModal} class="my-office-false"></lightning-button>
					<lightning-spinner if:true={showSpinner} alternative-text="Cargando..." variant="brand" size="medium" class="spin-cls" ></lightning-spinner>
				</lightning-tab>
			</lightning-tabset>
		</lightning-card>
	</div>
    <!-- CONFIRMATION ACTION MODAL -->
    <div if:true={isModalOpen}>
		<c-av_-task-opp-modal is-modal-open={isModalOpen} action-type={actionType} selected-items={selectedItems} onclosemodal={handleCloseModal} onconfirm={doAction}></c-av_-task-opp-modal>
	</div>
</template>