<template>
    <div if:true={opptask.AV_IsMain__c} >
		<div class="slds-section__title slds-theme_shade section-div">
			<lightning-layout>
				<lightning-layout-item class="center-buttons chever-buttons">
					<lightning-button-icon if:true={showDetailMain} icon-name="utility:chevrondown" size="small" class="chev-icon" variant="container" onclick={toggleShowOppTaskMain}></lightning-button-icon>
					<lightning-button-icon if:false={showDetailMain} icon-name="utility:chevronright" size="small" class="chev-icon" variant="container" onclick={toggleShowOppTaskMain}></lightning-button-icon>
				</lightning-layout-item>
				<lightning-layout-item>
					<label class="opptask-name opptask-title">{opptask.Name}</label>
					<small if:true={opptask.AV_Product__c}>{opptask.AV_Product__r.Name} | </small><small class="opptask-stage">{opptask.AV_Stage__c}</small>
				</lightning-layout-item>
				<template if:false={justOne}>
					<lightning-layout-item alignment-bump="left" class="center-buttons">
						<div class="button-group">
							<lightning-icon icon-name="utility:favorite" size="small" variant="warning" class="main-icon" title="Oportunidad principal"></lightning-icon>
							<span class="slds-text-color_weak main-label span-button">Principal</span>
						</div>
					</lightning-layout-item>
				</template>
				<template if:true={justOne}>
					<lightning-layout-item alignment-bump="left" class="center-buttons">
						<div class="button-group last-opptask-button">
							<lightning-icon icon-name="utility:favorite" size="small" variant="warning" class="main-icon" title="Oportunidad principal"></lightning-icon>
							<span class="slds-text-color_weak main-label span-button">Principal</span>
						</div>
					</lightning-layout-item>
					<lightning-layout-item class="center-buttons">
						<div class="button-group" onclick={handleUnlink}>
							<lightning-button-icon icon-name="utility:link" alternative-text="Desvincular la oportunidad de la tarea" class="slds-m-left_xx-small" title="Desvincular la oportunidad de la tarea" variant="brand" label="Desvincular" size="medium"></lightning-button-icon>
							<span class="button-label span-button">Desvincular</span>
						</div>
					</lightning-layout-item>
				</template>
			</lightning-layout>
		</div>
		<div if:true={showDetailMain} class="opptask-form">
			<lightning-record-view-form
				record-id={opptask.Id}
				object-api-name="AV_CustomActivityOpportunity__c"
				columns="3">

				<lightning-layout multiple-rows>
					<lightning-layout-item size="12" small-device-size="12" medium-device-size="6" large-device-size="4" padding="around-small">
						<div class="slds-col">
							<label class="slds-form-element__label read-only-label">{label.productFieldLabel}</label>
							<p if:true={opptask.AV_Product__c} class="read-only-field">{opptask.AV_Product__r.Name}</p>
						</div>
						<div class="slds-col">
							<lightning-output-field field-name="AV_Priority__c" variant="label-stacked">
							</lightning-output-field>
						</div>
					</lightning-layout-item>
					<lightning-layout-item size="12" small-device-size="12" medium-device-size="6" large-device-size="4" padding="around-small">
						<div class="slds-col">
							<lightning-output-field field-name="AV_Gestor__c" variant="label-stacked">
							</lightning-output-field>
						</div>
						<div class="slds-col">
							<lightning-output-field field-name="AV_ReviewDate__c" variant="label-stacked">
							</lightning-output-field>
						</div>
					</lightning-layout-item>
					<lightning-layout-item size="12" small-device-size="12" medium-device-size="6" large-device-size="4" padding="around-small">
						<div class="slds-col">
							<label class="slds-form-element__label read-only-label">{label.recordtypeFieldLabel}</label>
							<template if:true={opptask.AV_Opportunity__c}>
								<p if:true={opptask.AV_Opportunity__r.RecordTypeId} class="read-only-field">{opptask.AV_Opportunity__r.RecordType.Name}</p>
							</template>
						</div>
						<div class="slds-col">
							<lightning-output-field field-name="AV_HoldingAnotherEntity__c" variant="label-stacked">
							</lightning-output-field>
						</div>
					</lightning-layout-item>
				</lightning-layout>

			</lightning-record-view-form>
		</div>
	</div>
	<div>
		<div if:false={opptask.AV_IsMain__c} class="slds-section__title slds-theme_shade section-div">
			<lightning-layout>
				<lightning-layout-item class="center-buttons chever-buttons">
					<lightning-button-icon if:true={showDetail} icon-name="utility:chevrondown" size="small" class="chev-icon" variant="container" onclick={toggleShowOppTask}></lightning-button-icon>
					<lightning-button-icon if:false={showDetail} icon-name="utility:chevronright" size="small" class="chev-icon" variant="container" onclick={toggleShowOppTask}></lightning-button-icon>
				</lightning-layout-item>
				<lightning-layout-item>
					<label class="opptask-name opptask-title">{opptask.Name}</label>
					<small if:true={opptask.AV_Product__c}>{opptask.AV_Product__r.Name} | </small><small class="opptask-stage">{opptask.AV_Stage__c}</small>
				</lightning-layout-item>
				<lightning-layout-item alignment-bump="left" class="center-buttons">
					<div class="button-group last-opptask-button" onclick={handleMain}>
						<lightning-button-icon icon-name="utility:favorite" alternative-text="Convertir en oportunidad principal" class="slds-m-left_xx-small" title="Convertir en oportunidad principal" variant="border-filled" size="medium"></lightning-button-icon>
						<span class="button-label span-button">Convertir en Principal</span>
					</div>
				</lightning-layout-item>
				<lightning-layout-item class="center-buttons">
					<div class="button-group" onclick={handleUnlink}>
						<lightning-button-icon icon-name="utility:link" alternative-text="Desvincular la oportunidad de la tarea" class="slds-m-left_xx-small" title="Desvincular la oportunidad de la tarea" variant="brand" label="Desvincular" size="medium"></lightning-button-icon>
						<span class="button-label span-button">Desvincular</span>
					</div>
				</lightning-layout-item>
			</lightning-layout>
		</div> 
		<div if:true={showDetail} class="opptask-form">
			<lightning-record-view-form
				record-id={opptask.Id}
				object-api-name="AV_CustomActivityOpportunity__c"
				columns="3">

				<lightning-layout multiple-rows>
					<lightning-layout-item size="12" small-device-size="12" medium-device-size="6" large-device-size="4" padding="around-small">
						<div class="slds-col">
							<label class="slds-form-element__label read-only-label">{label.productFieldLabel}</label>
							<p if:true={opptask.AV_Product__c} class="read-only-field">{opptask.AV_Product__r.Name}</p>
						</div>
						<div class="slds-col">
							<lightning-output-field field-name="AV_Priority__c" variant="label-stacked">
							</lightning-output-field>
						</div>
					</lightning-layout-item>
					<lightning-layout-item size="12" small-device-size="12" medium-device-size="6" large-device-size="4" padding="around-small">
						<div class="slds-col">
							<lightning-output-field field-name="AV_Gestor__c" variant="label-stacked">
							</lightning-output-field>
						</div>
						<div class="slds-col">
							<lightning-output-field field-name="AV_ReviewDate__c" variant="label-stacked">
							</lightning-output-field>
						</div>
					</lightning-layout-item>
					<lightning-layout-item size="12" small-device-size="12" medium-device-size="6" large-device-size="4" padding="around-small">
						<div class="slds-col">
							<label class="slds-form-element__label read-only-label">{label.recordtypeFieldLabel}</label>
							<template if:true={opptask.AV_Opportunity__c}>
								<p if:true={opptask.AV_Opportunity__r.RecordTypeId} class="read-only-field">{opptask.AV_Opportunity__r.RecordType.Name}</p>
							</template>
						</div>
						<div class="slds-col">
							<lightning-output-field field-name="AV_HoldingAnotherEntity__c" variant="label-stacked">
							</lightning-output-field>
						</div>
					</lightning-layout-item>
				</lightning-layout>

			</lightning-record-view-form>
		</div>
	</div>

	<!-- CONFIRMATION ACTION MODAL -->
	<div if:true={isModalOpen}>
		<c-av_-task-opp-modal is-modal-open={isModalOpen} action-type={actionType} onclosemodal={handleCloseModal} onconfirm={doAction}></c-av_-task-opp-modal>
	</div>
</template>