<!-- sldsValidatorIgnore -->
<template>
    <lightning-button icon-name="utility:open_folder" label="Seleccionar plantilla" onclick={mostrarModalPlantillas}></lightning-button>

    <!--Modal seleccionar plantilla-->
    <section role="dialog" tabindex="-1" aria-modal="true" class="modalSeleccionarPlantilla slds-modal" onkeydown={modalSeleccionarPlantillaOnkeydown}>
        <div class="slds-modal__container">
            <header class="slds-modal__header">
                <!-- sldsValidatorIgnoreNextLine -->
                <lightning-button-icon icon-name="utility:close" size="large" onclick={cerrarModalPlantillas} variant="border-filled" class="slds-button slds-button_icon slds-modal__close"></lightning-button-icon>
                <h2 class="slds-text-heading_medium slds-hyphenate">Seleccionar plantilla</h2>
            </header>

            <div class="slds-modal__content slds-var-p-around_medium">
                <!-- Directorio de carpetas -->
                <div class="slds-grid">
                    <div class="slds-col slds-size_1-of-4">
                        <lightning-layout class="slds-grid_vertical-stretch">
                            <lightning-layout-item>
                                <lightning-vertical-navigation class="verticalNavigation" onselect={verticalNavigationOnselect} >
                                    <lightning-vertical-navigation-section label="Operativas">
                                        <template lwc:if={carpetaRaiz} for:each={carpetaRaiz.subcarpetas} for:item="carpeta">
                                            <lightning-vertical-navigation-item-icon key={carpeta.Id} class="carpeta" label={carpeta.Name} name={carpeta.Id} icon-name="utility:open_folder"></lightning-vertical-navigation-item-icon>
                                        </template>
                                    </lightning-vertical-navigation-section>
                                    <!--
                                    <lightning-vertical-navigation-section label="Recientes" class="slds-var-m-top_small">
                                        <lightning-vertical-navigation-item-icon class="reciente" label="Oferta comercial 90%" name="Oferta comercial 90%" icon-name="standard:template"></lightning-vertical-navigation-item-icon>
                                        <lightning-vertical-navigation-item-icon class="reciente" label="Oferta comercial" name="Oferta comercial" icon-name="standard:template"></lightning-vertical-navigation-item-icon>
                                        <lightning-vertical-navigation-item-icon class="reciente" label="Propuesta no vinculante" name="Propuesta no vinculante" icon-name="standard:template"></lightning-vertical-navigation-item-icon>
                                    </lightning-vertical-navigation-section>
                                    -->
                                </lightning-vertical-navigation>
                            </lightning-layout-item>
                        </lightning-layout>
                    </div>

                    <div class="slds-col slds-size_3-of-4 slds-scrollable slds-var-p-vertical_medium slds-var-p-horizontal_x-large" style="border-left: 1px solid rgb(201, 201, 201); max-height: 25rem;">
                        <div class="slds-grid slds-grid_vertical" style="height: 100%;">
                            <div class="slds-col slds-var-m-bottom_large slds-var-m-left_small">
                                <lightning-icon icon-name="utility:breadcrumbs" size="x-small" class="slds-is-relative" style="top: -2px;"></lightning-icon>
                                <lightning-breadcrumbs lwc:if={ruta.length} class="ruta slds-var-m-left_small" style="display: inline-block;">
                                    <template for:each={ruta} for:item="carpeta">
                                        <lightning-breadcrumb key={carpeta.Id} label={carpeta.Name} onclick={breadcumbOnclick} data-id={carpeta.Id}></lightning-breadcrumb>
                                    </template>
                                </lightning-breadcrumbs>
                            </div>
                            <div class="slds-col" style="height: 100%;">
                                <article class="slds-card slds-card_boundary" style="height: 100%;">
                                    <div class="slds-card__body slds-card__body_inner slds-var-p-vertical_medium slds-var-p-horizontal_x-large">
                                        <!-- Lookup -->
                                        <div class="slds-form-element slds-var-p-bottom_medium">
                                            <div class="slds-form-element__control">
                                                <!-- Sin resultado seleccionado (buscador) -->
                                                <div class="slds-combobox_container">
                                                    <div class="lookupBusqueda slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click">
                                                        <!-- Input de bÃºsqueda -->
                                                        <div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right" role="none">
                                                            <lightning-input
                                                                class="lookupBusquedaInput"
                                                                type="search"
                                                                value={lookupBusquedaInputValue}
                                                                placeholder="Buscar en esta carpeta"
                                                                variant="label-hidden"
                                                                autocomplete="off"
                                                                onchange={lookupBusquedaInputOnchange}
                                                                onkeydown={lookupBusquedaInputOnkeydown}
                                                                onfocus={lookupBusquedaAbrir}
                                                                onblur={lookupBusquedaCerrar}>
                                                            </lightning-input>
                                                        </div>
                                                        <template lwc:if={lookupBusquedaResultados.length}>
                                                            <!-- Lista de resultados -->
                                                            <!-- sldsValidatorIgnoreNextLine -->
                                                            <div class="slds-dropdown slds-dropdown_length-with-icon-7 slds-dropdown_fluid" role="listbox" tabindex="0" aria-busy="false">
                                                                <ul class="slds-listbox slds-listbox_vertical" role="presentation">
                                                                    <template for:each={lookupBusquedaResultados} for:item="resultado">
                                                                        <!-- Resultado -->
                                                                        <li key={resultado.Id} role="presentation" class="slds-listbox__item" onclick={lookupBusquedaSeleccionarResultado} data-id={resultado.Id}>
                                                                            <div class="slds-media slds-listbox__option slds-listbox__option_entity slds-listbox__option_has-meta" role="option">
                                                                                <!-- Icono del resultado -->
                                                                                <span class="slds-media__figure slds-listbox__option-icon slds-is-relative" style="top: -3px;">
                                                                                    <lightning-icon icon-name="standard:template" size="small"></lightning-icon>
                                                                                </span>
                                                                                <span class="slds-media__body">
                                                                                    <span class="slds-listbox__option-text_entity" style="font-weight: 500;">{resultado.Name}</span>
                                                                                    <span class="slds-listbox__option-meta" style="font-weight: 300; padding-top: 1px;">{resultado.Subject}</span>
                                                                                </span>
                                                                            </div>
                                                                        </li>
                                                                    </template>
                                                                </ul>
                                                            </div>
                                                        </template>
                                                        <template lwc:else>
                                                            <!-- Mensaje si no hay resultados -->
                                                            <template lwc:if={lookupBusquedaInputValue}>
                                                                <!-- sldsValidatorIgnoreNextLine -->
                                                                <div class="slds-dropdown slds-dropdown_length-with-icon-5 slds-dropdown_fluid" role="listbox" tabindex="0" aria-busy="false">
                                                                    <ul class="slds-listbox slds-listbox_vertical" role="presentation">
                                                                        <li role="presentation" class="slds-listbox__item">
                                                                            <div aria-selected="true" class="slds-media slds-listbox__option slds-listbox__option_entity slds-listbox__option_term slds-has-focus" role="option" style="cursor: default;">
                                                                                <span class="slds-media__body">
                                                                                    <span class="slds-listbox__option-text_entity slds-text-color_weak">No hay resultados.</span>
                                                                                </span>
                                                                            </div>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </template>
                                                        </template>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <template lwc:if={carpetaActual}>
                                            <ol class="itemsCarpeta">
                                                <template for:each={carpetaActual.subcarpetas} for:item="carpeta">
                                                    <li key={carpeta.Id} class="itemCarpeta">
                                                        <span onclick={carpetaOnclick} data-id={carpeta.Id}>
                                                            <lightning-icon icon-name="utility:open_folder" size="x-small" class="slds-var-m-right_medium"></lightning-icon>
                                                            <span class="itemCarpetaLabel">{carpeta.Name}</span>
                                                        </span>
                                                    </li>
                                                </template>
                                                <template for:each={carpetaActual.plantillas} for:item="plantilla">
                                                    <li key={plantilla.Id} class="itemCarpeta">
                                                        <span onclick={plantillaOnclick} data-id={plantilla.Id}>
                                                            <lightning-icon icon-name="standard:template" size="x-small" class="slds-var-m-right_medium"></lightning-icon>
                                                            <span class="itemCarpetaLabel">{plantilla.Name}</span>
                                                        </span>
                                                        <lightning-button-icon icon-name="utility:preview" variant="bare" tooltip="Ver detalle de la plantilla" class="botonVerPlantilla slds-var-m-left_x-large" onclick={navegarRegistroPlantilla} data-id={plantilla.Id}></lightning-button-icon>
                                                    </li>
                                                </template>
                                            </ol>
                                        </template>
                                    </div>
                                </article>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <footer class="slds-modal__footer">
                <div class="slds-grid slds-grid_align-spread slds-grid_vertical-align-center">
                    <div class="slds-col">
                        <span lwc:if={plantillaSeleccionada} class="slds-var-m-left_medium">
                            <span class="slds-var-m-right_medium">Plantilla seleccionada:</span>
                            <lightning-icon icon-name="standard:template" size="x-small" class="slds-var-m-right_small slds-is-relative" style="top: -1px;"></lightning-icon>
                            <span style="font-weight: 500;">{plantillaSeleccionada.Name}</span>
                        </span>
                    </div>
                    <div class="slds-col">
                        <lightning-button class="botonCancelar slds-var-m-left_small" label="Cancelar" onclick={cerrarModalPlantillas}></lightning-button>
                        <lightning-button class="botonAplicar slds-var-m-left_small" label="Seleccionar plantilla" variant="brand" onclick={botonAplicarOnclick} disabled></lightning-button>
                    </div>
                </div>
            </footer>
        </div>
    </section>

</template>