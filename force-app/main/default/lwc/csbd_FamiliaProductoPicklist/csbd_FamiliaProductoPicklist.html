<template>
	<lightning-card lwc:ref="cardComponente" class="cardComponente slds-is-relative" onclick={cardComponenteOnclick}>
		<div lwc:ref="seccion" class="seccion slds-section slds-is-relative section-layout-container slds-is-open">
			<h3 class="label slds-truncate slds-var-p-around_small slds-theme_shade" onclick={tituloSeccionOnclick}>
				<button aria-expanded="true" class="slds-button slds-section__title-action">
					<lightning-icon icon-name="utility:chevrondown" size="x-small" class="slds-section__title-action-icon slds-button__icon slds-button__icon_left slds-icon-utility-switch slds-icon_container"></lightning-icon>
					<span class="slds-truncate" title="Información del producto" style="font-size: 14px;">Información del producto</span>
				</button>
			</h3>
			<div class="slds-section__content section-content-grid slds-is-relative">
				<div lwc:if={spinner} align="center">
					<lightning-spinner style="position: absolute;" alternative-text="Guardando..."></lightning-spinner>
				</div>

				<!--
				<div lwc:if={editando} class="slds-var-m-top_medium slds-var-m-bottom_x-large">
					<c-csbd_-buscador-producto record-id={recordId} onresultadoseleccionado={buscadorResultadoSeleccionado}></c-csbd_-buscador-producto>
				</div>
				-->

				<div class="slds-form" role="list">
					<div class="slds-form__row">
						<div class="slds-form__item" role="listitem">
							<template lwc:if={editando}>
								<div class="slds-form-element slds-form-element_edit slds-form-element_horizontal slds-hint-parent" >
									<lightning-button-icon icon-name="utility:undo" variant="bare" class="undo slds-is-absolute" style="top: 0; right: 4px; z-index: 1;" onclick={deshacer} data-campo="empresaProveedora"></lightning-button-icon>
									<label class="slds-form-element__label">Empresa proveedora</label>
									<div class="slds-form-element__control">
										<lightning-combobox lwc:ref="comboboxEmpresas" class="comboboxEmpresas" options={opcionesEmpresaProveedora} value={empresaProveedora.value} onchange={comboboxEmpresasOnchange} onfocus={comboboxEmpresasOnfocus}> </lightning-combobox>
									</div>
								</div>
							</template>
                            <div lwc:else class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_horizontal slds-hint-parent" ondblclick={inicioEditando}>
                                <label class="slds-form-element__label">Empresa proveedora</label>
								<div class="slds-form-element__control">
                                    <div class="slds-form-element__static">{empresaProveedora.labelNoEdit}</div>
									<lightning-button-icon icon-name="utility:edit" variant= "bare" onclick={inicioEditando}></lightning-button-icon>
								</div>
                            </div>
						</div>
						<div class="slds-form__item" role="listitem">
							<div lwc:if={editando} class="slds-form-element slds-form-element_edit slds-form-element_horizontal slds-hint-parent">
								<label class="slds-form-element__label">Origen</label>
								<div class="slds-form-element__control">
									<div class="slds-form-element__static slds-truncate" title={origen}>{origen}</div>
									<template lwc:if={detallesOrigen.hayDetalles}>
										<lightning-button-icon lwc:if={formularioOrigenVisible} icon-name="utility:hide" size="medium" variant="bare" tooltip="Ocultar detalles del origen" onclick={mostrarFormularioOrigen} class="buttonIconBrand slds-var-m-right_x-small"></lightning-button-icon>
										<lightning-button-icon lwc:else icon-name="utility:preview" size="medium" variant="bare" tooltip="Ver detalles del origen" onclick={mostrarFormularioOrigen} class="slds-var-m-right_x-small"></lightning-button-icon>
									</template>
								</div>
							</div>
                            <div lwc:else class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_horizontal slds-hint-parent">
								<label class="slds-form-element__label">Origen</label>
								<div class="slds-form-element__control">
									<div class="slds-form-element__static slds-truncate" title={origen}>{origen}</div>
									<template lwc:if={detallesOrigen.hayDetalles}>
										<lightning-button-icon lwc:if={formularioOrigenVisible} icon-name="utility:hide" size="medium" variant="bare" tooltip="Ocultar detalles del origen" onclick={mostrarFormularioOrigen} class="buttonIconBrand slds-var-m-right_x-small"></lightning-button-icon>
										<lightning-button-icon lwc:else icon-name="utility:preview" size="medium" variant="bare" tooltip="Ver detalles del origen" onclick={mostrarFormularioOrigen} class="slds-var-m-right_x-small"></lightning-button-icon>
									</template>
								</div>
							</div>
						</div>
					</div>
					<div class="slds-form__row">
                        <div class="slds-form__item" role="listitem">
							<template lwc:if={editando}>
								<div class="slds-form-element slds-form-element_edit slds-form-element_horizontal slds-hint-parent" >
									<lightning-button-icon icon-name="utility:undo" variant="bare" class="undo slds-is-absolute" style="top: 0; right: 4px; z-index: 1;" onclick={deshacer} data-campo="familiaProducto"></lightning-button-icon>
									<label class="slds-form-element__label">Familia de producto</label>
									<div  class="slds-form-element__control">
										<lightning-combobox lwc:ref="comboboxFamilias" class="comboboxFamilias" options={opcionesFamiliaProducto} value={familiaProducto.value} onchange={comboboxFamiliasProductoOnchange} onfocus={comboboxFamiliasProductoOnfocus}></lightning-combobox>
									</div>
								</div>
							</template>
                            <div lwc:else class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_horizontal slds-hint-parent" ondblclick={inicioEditando}>
                                <label class="slds-form-element__label">Familia de producto</label>
								<div class="slds-form-element__control">
									<div class="slds-form-element__static">{familiaProducto.labelNoEdit}</div>
									<lightning-button-icon icon-name="utility:edit" variant= "bare" onclick={inicioEditando}></lightning-button-icon>
								</div>
                            </div>
						</div>
						<div class="slds-form__item" role="listitem">
							<div lwc:if={editando} class="slds-form-element slds-form-element_edit slds-form-element_horizontal slds-hint-parent">
								<label class="slds-form-element__label">Canal</label>
								<div class="slds-form-element__control">
									<div class="slds-form-element__static">{canal}</div>
								</div>
							</div>
                            <div lwc:else class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_horizontal slds-hint-parent">
								<label class="slds-form-element__label">Canal</label>
								<div class="slds-form-element__control">
									<div class="slds-form-element__static">{canal}</div>
								</div>
							</div>
						</div>
					</div>
					<div class="slds-form__row">
                        <div class="slds-form__item" role="listitem">
							<template lwc:if={editando}>
								<div class="slds-form-element slds-form-element_edit slds-form-element_horizontal slds-hint-parent" >
									<lightning-button-icon icon-name="utility:undo" variant="bare" class="undo slds-is-absolute" style="top: 0; right: 4px; z-index: 1;" onclick={deshacer} data-campo="producto"></lightning-button-icon>
									<label class="slds-form-element__label">Producto</label>
									<div lwc:if={editando} class="slds-form-element__control">
										<lightning-combobox lwc:ref="comboboxProductos" class="comboboxProductos" options={opcionesProducto} value={producto.value} onchange={comboboxProductosOnchange} onfocus={comboboxProductosOnfocus}></lightning-combobox>
									</div>
								</div>
							</template>
                            <div lwc:else class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_horizontal slds-hint-parent" ondblclick={inicioEditando}>
                                <label class="slds-form-element__label">Producto</label>
								<div class="slds-form-element__control">
									<div class="slds-form-element__static">{producto.labelNoEdit}</div>
									<lightning-button-icon icon-name="utility:edit" variant= "bare" onclick={inicioEditando}></lightning-button-icon>
								</div>
                            </div>
						</div>
						<div class="slds-form__item" role="listitem"></div>
					</div>
					<div class="slds-form__row">
						<div class="slds-form__item" role="listitem" lwc:if={mostrar.motivoMac} >
							<template lwc:if={editando}>
								<div class="slds-form-element slds-form-element_edit slds-form-element_horizontal slds-hint-parent" >
									<lightning-button-icon icon-name="utility:undo" variant="bare" class="undo slds-is-absolute" style="top: 0; right: 4px; z-index: 1;" onclick={deshacer} data-campo="motivoMac"></lightning-button-icon>
									<label class="slds-form-element__label">Motivo CSCC</label>
									<div lwc:if={editando} class="slds-form-element__control">
										<lightning-combobox class="comboboxMotivosMac" options={opcionesMotivoMac} value={motivoMac.value} onchange={comboboxMotivosMacOnchange} onfocus={comboboxMotivosMacOnfocus}></lightning-combobox>
									</div>
								</div>
							</template>
                            <div lwc:else class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_horizontal slds-hint-parent" ondblclick={inicioEditando}>
                                <label class="slds-form-element__label">Motivo CSCC</label>
								<div class="slds-form-element__control">
									<div class="slds-form-element__static">{motivoMac.labelNoEdit}</div>
									<lightning-button-icon icon-name="utility:edit" variant= "bare" onclick={inicioEditando}></lightning-button-icon>
								</div>
                            </div>
						</div>
						<div class="slds-form__item" role="listitem"></div>
					</div>
                    <div class="slds-form__row">
						<template lwc:if={mostrar.detalleProducto}>
							<div class="slds-form__item" role="listitem" >
								<div lwc:if={editando} class="slds-form-element slds-form-element_edit slds-form-element_horizontal slds-hint-parent" >
									<label class="slds-form-element__label">Detalle producto</label>
									<div class="slds-form-element__control">
										<div class="slds-form-element__static">{detalleProducto}</div>
									</div>
								</div>
								<div lwc:else class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_horizontal slds-hint-parent">
									<label class="slds-form-element__label">Detalle producto</label>
									<div class="slds-form-element__control">
										<div class="slds-form-element__static">{detalleProducto}</div>
									</div>
								</div>
							</div>
							<div class="slds-form__item" role="listitem"></div>
						</template>

						<template lwc:if={mostrar.vehiculo}>
							<div class="slds-form__item" role="listitem">
								<div lwc:if={editando} class="slds-form-element slds-form-element_edit slds-form-element_horizontal slds-hint-parent">
									<label class="slds-form-element__label">Vehículo</label>
									<div class="slds-form-element__control">
										<div class="slds-form-element__static">{vehiculo}</div>
									</div>
								</div>
								<div lwc:else class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_horizontal slds-hint-parent">
									<label class="slds-form-element__label">Vehículo</label>
									<div class="slds-form-element__control">
										<div class="slds-form-element__static">{vehiculo}</div>
									</div>
								</div>
							</div>
							<div class="slds-form__item" role="listitem"></div>
						</template>

						<template lwc:if={mostrar.finalidad}>
							<div class="slds-form__item" role="listitem">
								<div lwc:if={editando} class="slds-form-element slds-form-element_edit slds-form-element_horizontal slds-hint-parent">
									<label class="slds-form-element__label">Finalidad</label>
									<div class="slds-form-element__control">
										<div class="slds-form-element__static">{finalidad}</div>
									</div>
								</div>
								<div lwc:else class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_horizontal slds-hint-parent">
									<label class="slds-form-element__label">Finalidad</label>
									<div class="slds-form-element__control">
										<div class="slds-form-element__static">{finalidad}</div>
									</div>
								</div>
							</div>
							<div class="slds-form__item" role="listitem"></div>
						</template>
					</div>
				</div>

				<!--Detalles del origen-->
				<div lwc:if={formularioOrigenVisible} class="slds-box formularioOrigen slds-var-m-top_x-large slds-var-m-bottom_large slds-var-m-horizontal_x-large">
					<div class="slds-var-m-top_x-small slds-var-m-bottom_medium" style="font-size: 15px;">
						Detalles del origen
					</div>
					<div class="slds-form" role="list">
						<div class="slds-form__row" style="line-height: 20px;">
							<div class="slds-form__item" role="listitem">
								<div class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_horizontal slds-hint-parent">
									<label class="slds-form-element__label">Fuente</label>
									<div class="slds-form-element__control">
										<div class="slds-form-element__static">{detallesOrigen.fuente}</div>
									</div>
								</div>
							</div>
							<div class="slds-form__item" role="listitem">
								<div class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_horizontal slds-hint-parent">
									<label class="slds-form-element__label">Entorno</label>
									<div class="slds-form-element__control">
										<div class="slds-form-element__static">{detallesOrigen.entorno}</div>
									</div>
								</div>
							</div>
						</div>
						<div class="slds-form__row" style="line-height: 20px;">
							<div class="slds-form__item" role="listitem">
								<div class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_horizontal slds-hint-parent">
									<label class="slds-form-element__label">Página</label>
									<div class="slds-form-element__control">
										<div class="slds-form-element__static">{detallesOrigen.pagina}</div>
									</div>
								</div>
							</div>
							<div class="slds-form__item" role="listitem">
								<div class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_horizontal slds-hint-parent">
									<label class="slds-form-element__label">Tipo de campaña</label>
									<div class="slds-form-element__control">
										<div class="slds-form-element__static">{detallesOrigen.tipoCampaña}</div>
									</div>
								</div>
							</div>
						</div>
						<div class="slds-form__row" style="line-height: 20px;">
							<div class="slds-form__item" role="listitem">
								<div class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_horizontal slds-hint-parent">
									<label class="slds-form-element__label">Medio</label>
									<div class="slds-form-element__control">
										<div class="slds-form-element__static">{detallesOrigen.medio}</div>
									</div>
								</div>
							</div>
							<div class="slds-form__item" role="listitem">
								<div class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_horizontal slds-hint-parent">
									<label class="slds-form-element__label">Nombre de la campaña</label>
									<div class="slds-form-element__control">
										<div class="slds-form-element__static">{detallesOrigen.nombreCampaña}</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="slds-docked-form-footer footerEditando slds-is-relative" onclick={stopPropagation}>
				<div class="slds-grid slds-grid_vertical-align-center slds-gutters_direct-x-small">
					<div class="slds-col colBotonError">
						<lightning-button-icon icon-name="utility:error" variant="bare" size="large" class="slds-icon-text-error" onclick={botonErrorOnclick}></lightning-button-icon>
					</div>
					<div class="slds-col">
						<lightning-button label="Cancelar" onclick={cancelar}></lightning-button>
						<lightning-button label="Guardar" variant="brand" class="slds-var-m-left_medium" onclick={guardar}></lightning-button>
					</div>
				</div>

				<section lwc:ref="popoverError" class="popoverError slds-popover slds-popover_error slds-nubbin_bottom-left slds-is-relative" role="dialog" onclick={stopPropagation}>
					<button class="slds-button slds-button_icon slds-button_icon-small slds-float_right slds-popover__close slds-button_icon-inverse">
						<lightning-button-icon icon-name="utility:close" variant="bare-inverse" size="small" onclick={cerrarPopoverError}></lightning-button-icon>
					</button>
					<header class="slds-popover__header">
						<div class="slds-media slds-media_center slds-has-flexi-truncate">
							<div class="slds-media__figure">
								<lightning-icon icon-name="utility:error" variant="inverse" size="x-small"></lightning-icon>
							</div>
							<div class="slds-media__body">
								<h2 class="slds-truncate slds-text-heading_small">Se produjo un problema.</h2>
							</div>
						</div>
					</header>
					<div class="slds-popover__body">
						<p>{mensajeError}</p>
					</div>
				</section>
			</div>

		</div>
	</lightning-card>



</template>