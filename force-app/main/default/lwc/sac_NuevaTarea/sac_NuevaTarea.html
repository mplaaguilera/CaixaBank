<template>
    <template if:true={tienePermisosEditar}>
        <div class="slds-clearfix">
            <div class="slds-float_right">
                <lightning-button style="padding-left:8px" variant="brand" label="Nueva Tarea" onclick={abrirModalNuevaTarea}>
                </lightning-button>
            </div>
        </div>
    </template> 
    <template if:false={tienePermisosEditar}>
        <div class="slds-clearfix">
            <div class="slds-float_right">
                <lightning-button style="padding-left:8px" variant="brand" label="Nueva Tarea" disabled="true"></lightning-button>
            </div>
        </div>
    </template> 

    <!-- spinner -->
    <template if:true={spinnerLoading}>
        <div class="slds-is-relative">
            <lightning-spinner alternative-text="Loading" size="large" variant="brand"></lightning-spinner>
        </div>
    </template>

    <!-- Modal Crear Acción -->
    <template if:true={modalNuevaTarea}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_small">
            <div class="slds-modal__container">
                <header class="slds-modal__header">
                    <!-- Botón cerrar superior y cabecera -->
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={cerrarModalNuevaTarea}>
                        <lightning-icon icon-name="utility:close" alternative-text="close" variant="inverse" size="small" ></lightning-icon>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                    <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Crear Acción</h2>
                </header>
                <div class="slds-modal__content slds-p-around_large">
                    <div class="slds-form-element__control">
                        <!-- Botón seleccionable opción uno -->
                        <!-- <span class="slds-radio">  -->
                            <lightning-radio-group name="radioGroup"
                                options={options1}
                                value={value}
                                type="radio"
                                onchange={handleChange}></lightning-radio-group>
                                <span class="slds-form-element__label">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Acciones que ya están predefinidas</span>
                        <!-- </span> -->
                        <br><br>
                        <!-- Botón seleccionable opción dos -->
                        <!-- <span class="slds-radio"> -->
                            <lightning-radio-group name="radioGroup"
                                options={options2}
                                value={value}
                                type="radio"
                                onchange={handleChange}></lightning-radio-group>
                            <span class="slds-form-element__label">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Creación de nuevas tareas</span>
                        <!-- </span>   -->
                      </div>
                      <br>
                </div>
                
                <!-- Botones cancelar y siguiente -->
                <footer class="slds-modal__footer">
                    <lightning-button label="Cancelar" onclick={cerrarModalNuevaTarea} class="slds-m-left_x-small"></lightning-button>
                    <lightning-button variant="brand" label="Siguiente" onclick={tareaSeleccionada} class="slds-m-left_x-small"></lightning-button>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>


    <!-- Modal Otras Tareas y Maestro Tareas --> 
    <template if:true={modalSelectTarea}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_medium">
            <div class="slds-modal__container">
                <!-- Botón cerrar superior y cabecera -->
                <header class="slds-modal__header">
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={cerrarModalNuevaTarea}>
                        <lightning-icon icon-name="utility:close" alternative-text="close" variant="inverse" size="small" ></lightning-icon>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                    <!-- Cabecera diferente dependiendo si es Maestro Tareas u Otras Tareas -->
                    <h2 if:true={modalMaestroTareas} id="modal-heading-03" class="slds-text-heading_medium slds-hyphenate">Crear Acción: Maestro de tareas</h2>
                    <h2 if:true={modalOtrasTareas} id="modal-heading-02" class="slds-text-heading_medium slds-hyphenate">Crear Acción: Otras Tareas</h2>
                </header>
                <div class="slds-modal__content slds-p-around_large">
                    <div class="slds-form-element__control">
                            <div class="slds-p-around_small" style="background-color: rgb(226, 226, 226)">  <!---->
                                <h2 style="font-size: 15px" >Creación de tarea</h2>
                            </div>
                            <br>      
                            <table>
                                <tr>
                                    <!-- Input descripción, se mostrará únicamente si es Otras Tareas -->
                                    <td if:true={modalOtrasTareas} style="padding-right: 10px;">
                                        <div class="slds-form-element" id="columna11"> <!-- slds-has-error-->
                                            <label class="slds-form-element__label" for="text-input-id-48">
                                                <abbr class="slds-required" title="required">* </abbr>Descripción</label>
                                            <div class="slds-form-element__control">
                                                <input type="text" onkeyup={inputDescripcion} id="text-input-id-100" placeholder="Escriba una descripción…" required="" aria-describedby="error-message-id-49" class="slds-input" aria-invalid="true" />
                                            </div>
                                        </div>  
                                    </td>
                                    <!-- Buscador equipo responsable, se mostrará en ambos casos -->
                                    <td style="padding-left: 10px;">
                                        <div class="slds-form-element " id="columna9">
                                            <label if:true={modalOtrasTareas} class="slds-form-element__label" for="text-input-id-48">
                                                <abbr  class="slds-required" title="required">* </abbr>Equipo responsable</label>
                                            <label if:true={modalMaestroTareas} class="slds-form-element__label" for="text-input-id-48">
                                                <abbr class="slds-required" title="required">* </abbr>Maestro Acciones Reclamación</label>
                                            <div class="slds-form-element__control">
                                                <!-- Combobox -->
                                                <div>
                                                    <div class={formElementClasses}>
                                                        <div class="slds-form-element__control">
                                                            <div class="slds-combobox_container">
                                                                 <!-- controlador -->
                                                                <div if:true={controlador} class={classes}>
                                                                    <div
                                                                        class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right"
                                                                        role="none"
                                                                    >
                                                                        <div>
                                                                            <div class="slds-form-element__control slds-input-has-icon slds-input-has-icon_right ">
                                                                                <lightning-icon
                                                                                    size="x-small"
                                                                                    class="slds-icon slds-input__icon slds-input__icon_right slds-icon-text-default"
                                                                                    icon-name="utility:search"
                                                                                ></lightning-icon>
                                                                                <!-- Si es Otras Tareas: mostrar combobox -->
                                                                                <!-- sldsValidatorIgnoreNextLine -->
                                                                                <input if:true={modalOtrasTareas}
                                                                                    required={required}
                                                                                    type="text"
                                                                                    placeholder="Busque y seleccione el equipo deseado..."
                                                                                    id="text-input-id-1"
                                                                                    class={inputClasses}
                                                                                    value={value}
                                                                                    onkeyup={handleChanges}
                                                                                    onfocus={handleFocus}
                                                                                    onblur={handleBlur}
                                                                                    oninput={handleInput}
                                                                                    aria-invalid={isInvalid}
                                                                                    aria-describedby="form-error-01"
                                                                                />

                                                                                <!-- Si es Maestro Tareas: mostrar combobox -->
                                                                                <!-- sldsValidatorIgnoreNextLine -->
                                                                                <input if:true={modalMaestroTareas}
                                                                                    required={required}
                                                                                    type="text"
                                                                                    placeholder="Busque y seleccione una tarea predefinida..."
                                                                                    id="text-input-id-2"
                                                                                    class={inputClasses}
                                                                                    value={value}
                                                                                    onkeyup={handleChanges}
                                                                                    onfocus={handleFocus}
                                                                                    onblur={handleBlur}
                                                                                    oninput={handleInput}
                                                                                    aria-invalid={isInvalid}
                                                                                    aria-describedby="form-error-01"
                                                                                />
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <!-- Mostrar las opciones disponibles del selector -->
                                                                    <div
                                                                        if:true={tempOptions.length}
                                                                        id="listbox-id-5"
                                                                        class="slds-dropdown slds-dropdown_length-5 slds-dropdown_fluid"
                                                                        role="listbox"
                                                                        onmousedown={handleDropdownMouseDown}
                                                                        onmouseup={handleDropdownMouseUp}
                                                                        onmouseleave={handleDropdownMouseLeave}
                                                                    > <!--  -->
                                                                    
                                                                        <ul
                                                                            class="slds-listbox slds-listbox_vertical"

                                                                        >
                                                                            <li
                                                                                for:each={tempOptions}
                                                                                for:item="option"
                                                                                key={option.Name}
 
                                                                                class="slds-listbox__item"
                                                                                onclick={handleSelect}
                                                                                data-value={option.Name}
                                                                            >
                                                                                <div
                                                                                    onclick={handleSelect}
                                                                                    data-value={option.Name}
                                                                                    class={option.classes}

                                                                                    data-focused={option.focused}
                                                                                >
                                                                                    <span class="slds-media__figure slds-listbox__option-icon"></span>
                                                                                    <span class="slds-media__body">
                                                                                        <span
                                                                                            class="slds-truncate"
                                                                                            title={option.Name}
                                                                                        >{option.Name}</span>
                                                                                    </span>
                                                                                </div>
                                                                            </li>
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                                <!-- controlador dos -->
                                                                <div if:true={controladorDos} class={classes}>
                                                                    <div
                                                                        class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right"
                                                                        role="none"
                                                                    >
                                                                        <div>
                                                                            <div class="slds-form-element__control slds-input-has-icon slds-input-has-icon_right ">
                                                                                <lightning-icon
                                                                                    size="x-small"
                                                                                    class="slds-icon slds-input__icon slds-input__icon_right slds-icon-text-default"
                                                                                    icon-name="utility:search"
                                                                                ></lightning-icon>
                                                                                <!-- Si es Otras Tareas: mostrar combobox -->
                                                                                <!-- sldsValidatorIgnoreNextLine -->
                                                                                <input if:true={modalOtrasTareas}
                                                                                    required={required}
                                                                                    type="text"
                                                                                    placeholder="Busque y seleccione el equipo deseado..."
                                                                                    id="text-input-id-4"
                                                                                    class={inputClasses}
                                                                                    value={value}
                                                                                    onkeyup={handleChanges}
                                                                                    onfocus={handleFocus}
                                                                                    onblur={handleBlur}
                                                                                    oninput={handleInput}
                                                                                    aria-invalid={isInvalid}
                                                                                    aria-describedby="form-error-01"
                                                                                />

                                                                                <!-- Si es Maestro Tareas: mostrar combobox -->
                                                                                <!-- sldsValidatorIgnoreNextLine -->
                                                                                <input if:true={modalMaestroTareas}
                                                                                    required={required}
                                                                                    type="text"
                                                                                    placeholder="Busque y seleccione una tarea predefinida..."
                                                                                    id="text-input-id-5"
                                                                                    class={inputClasses}
                                                                                    value={value}
                                                                                    onkeyup={handleChanges}
                                                                                    onfocus={handleFocus}
                                                                                    onblur={handleBlur}
                                                                                    oninput={handleInput}
                                                                                    aria-invalid={isInvalid}
                                                                                    aria-describedby="form-error-01"
                                                                                />
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div> 
                                                            </div>
                                                        </div>
                                                        <!-- Mensaje de error -->
                                                        <div
                                                            class="slds-form-element__help"
                                                            if:true={isInvalid}
                                                            id="form-error-01"
                                                        >{messageWhenInvalid}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>   
                                    </td>
                                    <td if:true={modalMaestroTareas} style="padding-left: 50%">
                                    </td>
                                </tr>
                            </table>
                            <br>
                            <!-- Mensaje de error si queremos guardar sin completar todos los campos requeridos -->
                            <div if:true={campoVacio} class="slds-form-element__help" id="error-message-id-549" style="text-align: center; color: red; font-size: 16px;">Debe cumplimentar todos los campos.</div> 
                            <br><br><br><br><br><br><br><br>
                        <br> 
                      </div>
                      <br>
                </div>
                <!-- Botonera -->
                <footer class="slds-modal__footer">
                    <lightning-button label="Cancelar" onclick={cerrarModalNuevaTarea} class="slds-m-left_x-small"></lightning-button>
                    <lightning-button label="Anterior" onclick={anterior} class="slds-m-left_x-small"></lightning-button>
                    <lightning-button variant="brand" label="Guardar" onclick={guardarTarea} class="slds-m-left_x-small"></lightning-button>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
</template>